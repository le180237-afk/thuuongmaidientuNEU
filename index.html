import React, { useState } from 'react';
import { ShoppingBag, User, Home, Heart, Zap, MoreHorizontal, Shirt, Layers, DollarSign } from 'lucide-react';

// --- C·∫•u h√¨nh Tailwind CSS v√† M√†u Pastel M·ªõi (t·ª´ ·∫£nh 2) ---
const TONE = {
  BG_PRIMARY: '#F7F6F0', // M√†u kem/be s√°ng nh·∫•t t·ª´ ·∫£nh 2
  ACCENT_YELLOW: '#FCEB9C', // M√†u v√†ng nh·∫°t t·ª´ ·∫£nh 2
  ACCENT_GREEN: '#A2D396', // M√†u xanh l√° nh·∫°t t·ª´ ·∫£nh 2
  ACCENT_DARK_GREEN: '#6A994E', // M√†u xanh l√° ƒë·∫≠m h∆°n cho ch·ªØ n·ªïi b·∫≠t (d√πng cho c√°c chi ti·∫øt n·ªïi b·∫≠t)
  // ƒê√É C·∫¨P NH·∫¨T THEO Y√äU C·∫¶U: M√†u n√¢u ƒë·∫≠m ·∫•m √°p m·ªõi
  TEXT_DARK: '#5b402f', // M√†u n√¢u ƒë·∫≠m ·∫•m √°p m·ªõi (#5b402f)
  SHADOW_LIGHT: 'rgba(162, 211, 150, 0.4)', // B√≥ng t·ª´ m√†u xanh l√° nh·∫°t
  INPUT_BG: '#FFFFFF',
  GRADIENT_BG: `linear-gradient(135deg, #FCEB9C 0%, #F7F6F0 50%, #A2D396 100%)`, // Gradient l·∫•y c·∫£m h·ª©ng t·ª´ ·∫£nh 2
};

// --- D·ªØ li·ªáu gi·∫£ l·∫≠p s·∫£n ph·∫©m ---
const products = [
  { id: 1, name: "N·∫øn Th∆°m B√£ C√† Ph√™", price: "95.000", ecoTag: "T√°i Sinh", icon: "‚òï" },
  { id: 2, name: "Thi·ªáp Gi·∫•y H·∫°t Gi·ªëng", price: "45.000", ecoTag: "Gieo M·∫ßm", icon: "üå±" },
  { id: 3, name: "T√∫i Th∆°m V·ªè Cam Qu√Ωt", price: "70.000", ecoTag: "H∆∞∆°ng Th∆°m", icon: "üçä" },
  { id: 4, name: "Dreamcatcher V·∫£i Th·ª´a", price: "120.000", ecoTag: "Gi·∫£m R√°c", icon: "üåô" },
];

// --- C√°c t√≠nh nƒÉng n·ªïi b·∫≠t (l·∫•y c·∫£m h·ª©ng t·ª´ MBBank) ---
const features = [
  { icon: <Zap size={28} />, title: "Qu√† t·∫∑ng ƒê·ªôc ƒë√°o", desc: "Kh√¥ng ƒë·ª•ng h√†ng" },
  { icon: <Heart size={28} />, title: "Th√¢n thi·ªán M√¥i tr∆∞·ªùng", desc: "B·ªÅn v·ªØng t·ª´ t√¢m" },
  { icon: <MoreHorizontal size={28} />, title: "ChƒÉm s√≥c C√° nh√¢n", desc: "L·ªùi ch√∫c √Ω nghƒ©a" },
];

// --- API Configuration ---
const API_KEY = ""; // Leave as-is
const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;


// --- Components ---

/**
 * Component T√≠ch h·ª£p Gemini API ƒë·ªÉ t·∫°o l·ªùi ch√∫c vintage
 */
const GreetingCardGenerator = ({ selectedProduct }) => {
  const [occasion, setOccasion] = useState('');
  const [tone, setTone] = useState('');
  const [generatedText, setGeneratedText] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');

  const fetchWithExponentialBackoff = async (url, options, maxRetries = 5, delay = 1000) => {
    for (let i = 0; i < maxRetries; i++) {
        try {
            const response = await fetch(url, options);
            if (response.status !== 429 && response.ok) { 
                return response;
            }
            if (response.status === 429 && i < maxRetries - 1) { 
                await new Promise(resolve => setTimeout(resolve, delay * (2 ** i) + Math.random() * 1000));
            } else {
                return response; 
            }
        } catch (error) {
            if (i < maxRetries - 1) {
                await new Promise(resolve => setTimeout(resolve, delay * (2 ** i) + Math.random() * 1000));
            } else {
                throw error;
            }
        }
    }
    throw new Error('API request failed after multiple retries.');
  };

  const generateGreeting = async () => {
    if (!occasion || !tone) {
      setError('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß D·ªãp t·∫∑ng v√† C·∫£m x√∫c.');
      return;
    }

    setError('');
    setIsLoading(true);
    setGeneratedText('');

    // ƒê√É C·∫¨P NH·∫¨T: Thay th·∫ø Grift b·∫±ng D·ªát M·ªôc trong System Prompt
    const systemPrompt = `B·∫°n l√† chuy√™n gia vi·∫øt l·ªùi ch√∫c th∆∞ ph√°p, vintage v√† ·∫•m √°p cho th∆∞∆°ng hi·ªáu qu√† t·∫∑ng th√¢n thi·ªán m√¥i tr∆∞·ªùng D·ªát M·ªôc. L·ªùi ch√∫c c·∫ßn ng·∫Øn g·ªçn (t·ªëi ƒëa 3 c√¢u), t·∫≠p trung v√†o √Ω nghƒ©a t√°i sinh, thi√™n nhi√™n v√† s·ª± tr√¢n tr·ªçng.`;
    const userQuery = `H√£y vi·∫øt m·ªôt l·ªùi ch√∫c m·ª´ng cho s·∫£n ph·∫©m "${selectedProduct.name}" nh√¢n d·ªãp "${occasion}", v·ªõi t√¥ng ƒëi·ªáu "${tone}". Nh·∫•n m·∫°nh t√≠nh th·ªß c√¥ng v√† s·ª± ·∫•m √°p c·ªßa m√≥n qu√†.`;

    const payload = {
        contents: [{ parts: [{ text: userQuery }] }],
        systemInstruction: {
            parts: [{ text: systemPrompt }]
        },
    };

    try {
        const response = await fetchWithExponentialBackoff(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const result = await response.json();
        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

        if (text) {
            setGeneratedText(text);
        } else {
            setError('Kh√¥ng th·ªÉ t·∫°o l·ªùi ch√∫c. Vui l√≤ng th·ª≠ l·∫°i.');
        }
    } catch (e) {
        console.error('Gemini API Error:', e);
        setError('C√≥ l·ªói x·∫£y ra khi k·∫øt n·ªëi API. Vui l√≤ng ki·ªÉm tra console.');
    } finally {
        setIsLoading(false);
    }
  };
  


  return (
    <div className="p-4 mt-6 rounded-xl shadow-inner border border-dashed" style={{ backgroundColor: TONE.INPUT_BG, borderColor: TONE.ACCENT_GREEN }}>
      <h3 className="text-xl font-bold mb-3 flex items-center" style={{ color: TONE.ACCENT_DARK_GREEN, fontFamily: 'Playfair Display, serif' }}>
        <Zap size={20} className="mr-2"/> ƒê·ªÅ Xu·∫•t L·ªùi Ch√∫c ‚ú®
      </h3>
      <p className="text-sm mb-4" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>T·∫°o l·ªùi ch√∫c c√° nh√¢n h√≥a theo phong c√°ch D·ªát M·ªôc.</p>
      
      <div className="space-y-3">
        <div>
          <label className="block text-xs font-medium mb-1" style={{color: TONE.TEXT_DARK, fontFamily: 'Inter, sans-serif'}}>S·∫£n ph·∫©m:</label>
          <input 
            type="text" 
            value={selectedProduct.name} 
            disabled 
            className="w-full p-2 border rounded-lg bg-gray-100 text-sm"
            style={{ borderColor: TONE.ACCENT_GREEN, fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}
          />
        </div>

        <div>
          <label className="block text-xs font-medium mb-1" style={{color: TONE.TEXT_DARK, fontFamily: 'Inter, sans-serif'}}>D·ªãp t·∫∑ng qu√†:</label>
          <input 
            type="text" 
            value={occasion} 
            onChange={(e) => setOccasion(e.target.value)} 
            className="w-full p-2 border rounded-lg focus:ring-1 focus:outline-none text-sm"
            style={{ borderColor: TONE.ACCENT_GREEN, backgroundColor: TONE.INPUT_BG, fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}
            placeholder="Sinh nh·∫≠t, L·ªÖ T·ªët Nghi·ªáp..."
          />
        </div>

        <div>
          <label className="block text-xs font-medium mb-1" style={{color: TONE.TEXT_DARK, fontFamily: 'Inter, sans-serif'}}>T√¥ng ƒëi·ªáu:</label>
          <input 
            type="text" 
            value={tone} 
            onChange={(e) => setTone(e.target.value)} 
            className="w-full p-2 border rounded-lg focus:ring-1 focus:outline-none text-sm"
            style={{ borderColor: TONE.ACCENT_GREEN, backgroundColor: TONE.INPUT_BG, fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}
            placeholder="Vui v·∫ª, T√¥n tr·ªçng, ·∫§m √°p..."
          />
        </div>
        
        {error && <p className="text-red-500 text-xs mt-2" style={{ fontFamily: 'Inter, sans-serif' }}>{error}</p>}
        
        <button 
          onClick={generateGreeting} 
          disabled={isLoading}
          className="w-full py-2 rounded-lg text-white font-semibold text-sm hover:opacity-90 transition-opacity flex items-center justify-center disabled:opacity-50"
          style={{ backgroundColor: TONE.ACCENT_DARK_GREEN, fontFamily: 'Inter, sans-serif' }}
        >
          {isLoading ? (
            <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          ) : (
            <>
              T·∫°o L·ªùi Ch√∫c ‚ú®
            </>
          )}
        </button>
      </div>

      {generatedText && (
        <div className="mt-4 p-3 border rounded-lg bg-gray-50" style={{ borderColor: TONE.ACCENT_GREEN }}>
          <p className="text-xs font-medium" style={{color: TONE.ACCENT_DARK_GREEN, fontFamily: 'Inter, sans-serif'}}>L·ªùi Ch√∫c ƒê·ªÅ Xu·∫•t:</p>
          <p className="mt-1 text-sm italic leading-relaxed" style={{ color: TONE.TEXT_DARK, fontFamily: 'Lora, serif' }}>
            {generatedText}
          </p>
          {/* ƒê√É C·∫¨P NH·∫¨T: Thay th·∫ø Grift b·∫±ng D·ªát M·ªôc */}
          <p className="text-right text-xs mt-2 text-gray-500" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>‚Äî D·ªát M·ªôc x Gemini AI</p>
        </div>
      )}
    </div>
  );
};


/**
 * Hi·ªÉn th·ªã th·∫ª s·∫£n ph·∫©m (Mobile App Style)
 */
const ProductCard = ({ product, onSelectProduct }) => {
  return (
    <div 
      className="w-full bg-white rounded-xl shadow-md transition-all duration-300 transform hover:scale-[1.02] cursor-pointer overflow-hidden flex flex-col"
      style={{ boxShadow: `0 4px 12px ${TONE.SHADOW_LIGHT}` }}
    >
      {/* H√¨nh ·∫£nh s·∫£n ph·∫©m (Hi·ªÉn th·ªã icon) */}
      <div className="h-40 flex items-center justify-center rounded-t-xl overflow-hidden" 
           style={{backgroundColor: TONE.ACCENT_YELLOW}}> {/* N·ªÅn v√†ng nh·∫°t */}
        <span className="text-5xl">{product.icon}</span>
      </div>
      
      {/* Th√¥ng tin s·∫£n ph·∫©m */}
      <div className="p-3 flex flex-col justify-between flex-grow">
        <div>
            <div className="text-xs font-medium uppercase tracking-wider px-2 py-0.5 rounded-full inline-block" 
                style={{ backgroundColor: TONE.ACCENT_GREEN, color: 'white', fontFamily: 'Inter, sans-serif' }}> {/* Eco tag m√†u xanh l√° */}
              {product.ecoTag}
            </div>
            {/* T√™n s·∫£n ph·∫©m d√πng m√†u TEXT_DARK */}
            <h3 className="text-lg font-semibold mt-2 truncate" style={{color: TONE.TEXT_DARK, fontFamily: 'Quicksand, sans-serif'}}>{product.name}</h3>
            <p className="text-xl font-bold mt-1" style={{color: TONE.ACCENT_DARK_GREEN, fontFamily: 'Playfair Display, serif'}}>{product.price}‚Ç´</p>
        </div>
        
        <button 
            onClick={() => onSelectProduct(product)}
            className="mt-3 w-full py-2 rounded-lg text-white font-semibold text-sm hover:opacity-90 transition-opacity"
            style={{ backgroundColor: TONE.ACCENT_DARK_GREEN, fontFamily: 'Inter, sans-serif' }}
        >
            Th√™m v√†o Gi·ªè
        </button>
        <button 
            onClick={() => onSelectProduct(product)}
            className="mt-1 w-full py-2 rounded-lg text-sm font-semibold transition-colors border"
            style={{ borderColor: TONE.ACCENT_DARK_GREEN, color: TONE.ACCENT_DARK_GREEN, backgroundColor: TONE.BG_PRIMARY, fontFamily: 'Inter, sans-serif' }}
        >
            T·∫°o L·ªùi Ch√∫c
        </button>
      </div>
    </div>
  );
};

// --- Mobile/Desktop Header - ƒê√É C·∫¨P NH·∫¨T: Ch·ªâ gi·ªØ l·∫°i Logo v√† Gi·ªè h√†ng ---
const MobileHeader = ({ setActiveView }) => {
  return (
    // Header kh√¥ng c·ªë ƒë·ªãnh tr√™n desktop.
    <header className="py-4 px-6 flex justify-between items-center shadow-sm w-full" 
            style={{ backgroundColor: TONE.BG_PRIMARY }}>
        <div className="max-w-4xl mx-auto w-full flex justify-between items-center">
            {/* Logo - ƒê√É C·∫¨P NH·∫¨T: Thay th·∫ø Grift b·∫±ng D·ªát M·ªôc */}
            <h1 className="text-2xl font-bold" style={{ fontFamily: 'DM Serif Display, serif', color: TONE.ACCENT_DARK_GREEN }}>D·ªát M·ªôc</h1>
            
            {/* Cart Icon */}
            <button onClick={() => setActiveView('cart')} className="text-gray-600">
                <ShoppingBag size={24} style={{ color: TONE.ACCENT_DARK_GREEN }} />
            </button>
        </div>
    </header>
  );
};

// --- Thanh Tab Bar C·ªë ƒê·ªãnh ·ªü D∆∞·ªõi - THAY TH·∫æ CHO THANH ƒêI·ªÄU H∆Ø·ªöNG C≈® ---
const MobileBottomBar = ({ activeView, setActiveView }) => {
    // H√†m tr·ª£ gi√∫p ƒë·ªÉ quy·∫øt ƒë·ªãnh m√†u ch·ªØ cho n√∫t ƒëi·ªÅu h∆∞·ªõng
    const getNavColor = (viewName) => {
        return activeView === viewName ? TONE.ACCENT_DARK_GREEN : TONE.TEXT_DARK;
    };

    // ƒê·ªãnh nghƒ©a c√°c m·ª•c ƒëi·ªÅu h∆∞·ªõng v·ªõi Icon v√† Text
    // ƒê√É C·∫¨P NH·∫¨T: T√™n Green Gift, Green Fit v·∫´n gi·ªØ nguy√™n ƒë·ªÉ ph√π h·ª£p v·ªõi Icon/M·ª•c ƒë√≠ch
    const navItems = [
        { name: 'home', label: 'Green Gift', Icon: Home },
        { name: 'greenfit', label: 'Green Fit', Icon: Layers },
        { name: 'shop', label: '∆Øu ƒê√£i', Icon: DollarSign },
        { name: 'profile', label: 'C√° Nh√¢n', Icon: User },
    ];

    return (
        <div className="fixed bottom-0 left-0 right-0 z-50 shadow-lg border-t border-gray-200"
             style={{ backgroundColor: TONE.BG_PRIMARY }}>
            <div className="max-w-4xl mx-auto flex justify-around items-center h-16">
                {navItems.map(({ name, label, Icon }) => (
                    <button 
                        key={name}
                        onClick={() => setActiveView(name)}
                        className="flex flex-col items-center justify-center p-1 transition-colors"
                        style={{ color: getNavColor(name) }}
                    >
                        <Icon size={24} className="mb-0.5" />
                        <span className="text-xs font-semibold" style={{ fontFamily: 'Quicksand, sans-serif' }}>{label}</span>
                    </button>
                ))}
            </div>
        </div>
    );
};


/**
 * Trang Ch·ªß (Mobile App Layout) - Green Production & Commerce Zone
 */
const HomeView = () => {
  const [selectedProduct, setSelectedProduct] = useState(null);

  return (
    // ƒê√É C·∫¨P NH·∫¨T: Th√™m padding bottom (pb-24) ƒë·ªÉ n·ªôi dung kh√¥ng b·ªã thanh tab bar che m·∫•t
    <div className="pt-8 pb-24 min-h-screen relative" style={{ background: TONE.GRADIENT_BG }}>
      {/* Container gi·ªõi h·∫°n chi·ªÅu r·ªông tr√™n desktop */}
      <div className="max-w-4xl mx-auto p-4">
        
        {/* Banner Ch√≠nh - L·∫•y c·∫£m h·ª©ng t·ª´ MBBank */}
        <div className="bg-white rounded-xl p-6 mb-6 shadow-md" style={{ boxShadow: `0 8px 20px ${TONE.SHADOW_LIGHT}` }}>
          {/* Ti√™u ƒë·ªÅ d√πng m√†u ACCENT_DARK_GREEN - ƒê√É C·∫¨P NH·∫¨T: Thay th·∫ø Grift b·∫±ng D·ªát M·ªôc */}
          <h2 className="text-2xl font-bold mb-3" style={{ fontFamily: 'Playfair Display, serif', color: TONE.ACCENT_DARK_GREEN }}>D·ªát M·ªôc - Qu√† t·∫∑ng √Ω nghƒ©a</h2>
          {/* M√¥ t·∫£ d√πng TEXT_DARK */}
          <p className="text-base mb-4" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>
            Kh√°m ph√° nh·ªØng m√≥n qu√† ƒë·ªôc ƒë√°o, th√¢n thi·ªán v·ªõi m√¥i tr∆∞·ªùng, ƒë∆∞·ª£c l√†m th·ªß c√¥ng t·ª´ t√¢m huy·∫øt.
          </p>
          <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center mt-4">
            {features.map((feature, index) => (
              <div key={index} className="flex flex-col items-center p-3 bg-gray-50 rounded-lg shadow-sm" style={{borderColor: TONE.ACCENT_YELLOW, borderWidth: '1px'}}>
                <span className="mb-1" style={{color: TONE.ACCENT_DARK_GREEN}}>{feature.icon}</span>
                {/* Title v√† Desc ƒë·ªÅu d√πng TEXT_DARK */}
                <p className="text-sm font-semibold" style={{fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK}}>{feature.title}</p>
                <p className="text-xs text-gray-500" style={{fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK}}>{feature.desc}</p>
              </div>
            ))}
          </div>
        </div>

        {/* Ph·∫ßn "S·∫£n ph·∫©m n·ªïi b·∫≠t" - Ti√™u ƒë·ªÅ d√πng m√†u TEXT_DARK */}
        <h3 className="text-xl font-bold mb-4" style={{color: TONE.TEXT_DARK, fontFamily: 'Quicksand, sans-serif'}}>S·∫£n ph·∫©m d√†nh cho b·∫°n</h3>
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"> {/* TƒÉng s·ªë c·ªôt tr√™n desktop */}
          {products.map(p => 
            <ProductCard 
              key={p.id} 
              product={p} 
              onSelectProduct={setSelectedProduct} 
            />
          )}
        </div>
        
        {/* T√≠ch h·ª£p Gemini API */}
        {selectedProduct && (
          <div className="mt-8 max-w-2xl mx-auto"> {/* Thu h·∫πp khung AI tr√™n desktop */}
             <GreetingCardGenerator selectedProduct={selectedProduct} />
          </div>
        )}

      </div>
    </div>
  );
};

/**
 * C·∫¨P NH·∫¨T: Trang Green Inspire Zone (Green Fit) - M·∫°ng x√£ h·ªôi th·ªùi trang b·ªÅn v·ªØng
 */
const GreenFitHub = () => {
    // Gi·ªØ l·∫°i state GreenPoints ƒë·ªÉ m√¥ ph·ªèng ƒëi·ªÉm s·ªë hi·ªán t·∫°i
    const [greenPoints, setGreenPoints] = useState(550);
    const [aiOutfit, setAiOutfit] = useState('Ch∆∞a c√≥ g·ª£i √Ω');
    const [isGenerating, setIsGenerating] = useState(false);

    const generateOutfit = () => {
        setIsGenerating(true);
        setTimeout(() => {
            const outfits = [
                "√Åo s∆° mi linen tr·∫Øng + Qu·∫ßn culottes be (Phong c√°ch T·ªëi gi·∫£n)",
                "V√°y midi hoa nh√≠ (vintage) + T√∫i c√≥i th·ªß c√¥ng (Phong c√°ch Du m·ª•c)",
                "√Åo ph√¥ng t√°i ch·∫ø + Qu·∫ßn jeans ·ªëng r·ªông (ƒë√£ wax) + Gi√†y canvas (Phong c√°ch Street)",
            ];
            const randomOutfit = outfits[Math.floor(Math.random() * outfits.length)];
            setAiOutfit(randomOutfit);
            setIsGenerating(false);
        }, 1500);
    };

    return (
        // ƒê√É C·∫¨P NH·∫¨T: Th√™m padding bottom (pb-24) ƒë·ªÉ n·ªôi dung kh√¥ng b·ªã thanh tab bar che m·∫•t
        <div className="pt-8 pb-24 min-h-screen relative" style={{ background: TONE.GRADIENT_BG }}>
            <div className="max-w-4xl mx-auto p-4">
                {/* Banner Green Inspire Zone */}
                <div className="bg-white rounded-xl p-6 mb-6 shadow-md" style={{ boxShadow: `0 8px 20px ${TONE.SHADOW_LIGHT}` }}>
                    <h2 className="text-2xl font-bold mb-2 flex items-center" style={{ fontFamily: 'Playfair Display, serif', color: TONE.ACCENT_DARK_GREEN }}>
                        <Heart size={28} className="mr-3" /> Green Inspire Zone: Lan T·ªèa S·ªëng Xanh 
                    </h2>
                    <p className="text-sm" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>
                        Kh√¥ng gian chia s·∫ª outfits, m·∫πo t√°i ch·∫ø v√† trao ƒë·ªïi ƒë·ªì, nh·∫≠n GreenPoints cho m·ªói h√†nh ƒë·ªông t√≠ch c·ª±c!
                    </p>
                </div>

                {/* Khu v·ª±c Greenpoints - Ch·ªâ hi·ªÉn th·ªã ƒëi·ªÉm v√† li√™n k·∫øt ƒë·∫øn Profile */}
                <div className="bg-white rounded-xl p-5 mb-6 shadow-md flex justify-between items-center" style={{ border: `1px solid ${TONE.ACCENT_YELLOW}` }}>
                    <div className="flex items-center">
                        <Layers size={32} style={{ color: TONE.ACCENT_DARK_GREEN }} className="mr-4"/>
                        <div>
                            {/* Ch·ªØ th∆∞·ªùng d√πng TEXT_DARK */}
                            <p className="text-sm" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>ƒêi·ªÉm Xanh Hi·ªán C√≥</p>
                            <p className="text-3xl font-bold" style={{ color: TONE.ACCENT_DARK_GREEN, fontFamily: 'Quicksand, sans-serif' }}>{greenPoints}</p>
                        </div>
                    </div>
                    <button className="py-2 px-4 rounded-lg text-white font-semibold text-sm hover:opacity-90 transition-opacity"
                        style={{ backgroundColor: TONE.ACCENT_DARK_GREEN, fontFamily: 'Inter, sans-serif' }}
                        onClick={() => alert("Xem chi ti·∫øt Green Profile t·∫°i m·ª•c C√° Nh√¢n!")}>
                        Chi Ti·∫øt Profile
                    </button>
                </div>

                {/* C√¥ng c·ª• AI Ph·ªëi ƒë·ªì */}
                <div className="bg-white rounded-xl p-6 mb-6 shadow-md" style={{ border: `1px dashed ${TONE.ACCENT_GREEN}` }}>
                    {/* Ti√™u ƒë·ªÅ d√πng TEXT_DARK */}
                    <h3 className="text-xl font-bold mb-3" style={{ color: TONE.TEXT_DARK, fontFamily: 'Quicksand, sans-serif' }}>AI Qu√©t ƒê·ªì & Ph·ªëi Trang Ph·ª•c</h3>
                    <p className="text-sm" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>
                        T·∫£i ·∫£nh t·ªß ƒë·ªì c·ªßa b·∫°n l√™n ƒë·ªÉ nh·∫≠n g·ª£i √Ω ph·ªëi ƒë·ªì t·ª´ AI, gi√∫p b·∫°n "m·∫∑c ƒë·∫πp m√† kh√¥ng c·∫ßn mua th√™m".
                    </p>
                    
                    <button 
                        onClick={generateOutfit} 
                        disabled={isGenerating}
                        className="w-full py-3 rounded-lg text-white font-semibold text-base hover:opacity-90 transition-opacity flex items-center justify-center disabled:opacity-50"
                        style={{ backgroundColor: TONE.ACCENT_DARK_GREEN, fontFamily: 'Inter, sans-serif' }}
                    >
                         {isGenerating ? (
                            <svg className="animate-spin -ml-1 mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                          ) : (
                            <>
                              <Layers size={18} className="mr-2"/> G·ª£i √Ω Ph·ªëi ƒë·ªì
                            </>
                          )}
                    </button>
                    
                    {/* K·∫øt qu·∫£ AI */}
                    <div className="mt-4 p-4 rounded-lg bg-gray-50" style={{ borderColor: TONE.ACCENT_GREEN, border: '1px dashed' }}>
                        <p className="text-xs font-medium" style={{color: TONE.ACCENT_DARK_GREEN, fontFamily: 'Inter, sans-serif'}}>G·ª£i √Ω h√¥m nay:</p>
                        <p className="mt-1 text-base leading-relaxed" style={{ color: TONE.TEXT_DARK, fontFamily: 'Lora, serif' }}>
                            {aiOutfit}
                        </p>
                    </div>
                </div>
                
                {/* Khu v·ª±c Trao ƒë·ªïi C·ªông ƒë·ªìng: ƒê·ªïi t√™n th√†nh Trao ƒê·ªïi & T·∫∑ng ƒê·ªì (Swap) */}
                <div className="bg-white rounded-xl p-6 shadow-md" style={{ border: `1px solid ${TONE.ACCENT_GREEN}` }}>
                    {/* Ti√™u ƒë·ªÅ d√πng TEXT_DARK */}
                    <h3 className="text-xl font-bold mb-4" style={{ color: TONE.TEXT_DARK, fontFamily: 'Quicksand, sans-serif' }}>Trao ƒê·ªïi & T·∫∑ng ƒê·ªì (Swap)</h3>
                    <p className="text-sm mb-4" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>
                        K√©o d√†i v√≤ng ƒë·ªùi s·∫£n ph·∫©m: T·∫∑ng ƒë·ªì, ƒë·ªïi ƒë·ªì c≈© ch·∫•t l∆∞·ª£ng v√† nh·∫≠n GreenPoints.
                    </p>
                    <div className="space-y-3">
                        {/* Item 1 - ƒê·ªì ƒë·ªÉ Trao ƒê·ªïi */}
                        <div className="flex items-center p-3 bg-gray-50 rounded-lg shadow-sm">
                            <Shirt size={24} style={{ color: TONE.ACCENT_DARK_GREEN }} className="mr-3"/>
                            <div>
                                <p className="font-semibold text-sm" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>√Åo len Oversize (ƒê√£ gi·∫∑t s·∫°ch)</p>
                                <p className="text-xs" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>Ng∆∞·ªùi t·∫∑ng: JaneDoe | T√¨nh tr·∫°ng: 95%</p>
                            </div>
                        </div>
                        {/* Item 2 - ƒê·ªì ƒë·ªÉ B√°n/ƒê·ªïi ƒëi·ªÉm */}
                        <div className="flex items-center p-3 bg-gray-50 rounded-lg shadow-sm">
                            <DollarSign size={24} style={{ color: TONE.ACCENT_DARK_GREEN }} className="mr-3"/>
                            <div>
                                <p className="font-semibold text-sm" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>V√°y Denim c≈© - ƒê·ªïi l·∫•y 50 Greenpoints</p>
                                <p className="text-xs" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>Ng∆∞·ªùi b√°n: EcoUser21 | C·∫ßn 50 ƒëi·ªÉm</p>
                            </div>
                        </div>
                        
                        <button className="w-full py-2 rounded-lg text-sm font-semibold border mt-4" 
                            style={{ borderColor: TONE.ACCENT_DARK_GREEN, color: TONE.ACCENT_DARK_GREEN, backgroundColor: TONE.BG_PRIMARY, fontFamily: 'Inter, sans-serif' }}
                            onClick={() => alert("ƒêƒÉng t·∫£i m√≥n ƒë·ªì ƒë·ªÉ trao ƒë·ªïi ho·∫∑c t·∫∑ng ngay!")}>
                            ƒêƒÉng M√≥n ƒê·ªì c·ªßa B·∫°n
                        </button>
                    </div>
                </div>

            </div>
        </div>
    );
};


/**
 * Trang Gi·ªè H√†ng gi·∫£ l·∫≠p
 */
const CartView = () => {
    return (
        // ƒê√É C·∫¨P NH·∫¨T: Th√™m padding bottom (pb-24) ƒë·ªÉ n·ªôi dung kh√¥ng b·ªã thanh tab bar che m·∫•t
        <div className="pt-8 pb-24 min-h-screen flex flex-col items-center justify-center" style={{ background: TONE.GRADIENT_BG }}>
            <div className="p-8 rounded-xl bg-white shadow-md text-center max-w-md mx-auto" style={{ border: `1px solid ${TONE.ACCENT_GREEN}` }}>
                <ShoppingBag size={48} className="mx-auto mb-4" style={{ color: TONE.ACCENT_DARK_GREEN }} />
                {/* Ti√™u ƒë·ªÅ d√πng TEXT_DARK */}
                <h2 className="text-xl font-bold mb-2" style={{ fontFamily: 'Playfair Display, serif', color: TONE.TEXT_DARK }}>Gi·ªè h√†ng tr·ªëng</h2>
                {/* M√¥ t·∫£ d√πng TEXT_DARK */}
                <p className="text-sm mb-6" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>H√£y th√™m c√°c s·∫£n ph·∫©m y√™u th√≠ch v√†o gi·ªè h√†ng c·ªßa b·∫°n!</p>
                <button 
                    className="w-full py-2 rounded-lg text-white font-semibold text-sm hover:opacity-90 transition-opacity"
                    style={{ backgroundColor: TONE.ACCENT_DARK_GREEN, fontFamily: 'Inter, sans-serif' }}
                    onClick={() => {}} 
                >
                    Ti·∫øp t·ª•c mua s·∫Øm
                </button>
            </div>
        </div>
    );
};

/**
 * C·∫¨P NH·∫¨T: Trang C√° Nh√¢n/H·ªì S∆° gi·∫£ l·∫≠p - Th√™m Green Profile
 */
const ProfileView = () => {
    // D·ªØ li·ªáu gi·∫£ l·∫≠p cho Green Profile
    const [greenPoints, setGreenPoints] = useState(550);
    const [itemsSwapped, setItemsSwapped] = useState(8);
    const [postsShared, setPostsShared] = useState(12);

    return (
        // ƒê√É C·∫¨P NH·∫¨T: Th√™m padding bottom (pb-24) ƒë·ªÉ n·ªôi dung kh√¥ng b·ªã thanh tab bar che m·∫•t
        <div className="pt-8 pb-24 min-h-screen" style={{ background: TONE.GRADIENT_BG }}>
            <div className="max-w-4xl mx-auto p-4">
                
                {/* Khu v·ª±c Green Profile - TH√äM M·ªöI THEO D·ª∞ √ÅN */}
                <div className="bg-white rounded-xl p-6 mb-6 shadow-md" style={{ border: `1px solid ${TONE.ACCENT_YELLOW}` }}>
                    <h2 className="text-xl font-bold mb-4 flex items-center" style={{ fontFamily: 'Playfair Display, serif', color: TONE.ACCENT_DARK_GREEN }}>
                        <Heart size={24} className="mr-2"/> H√†nh Tr√¨nh Xanh (Green Profile)
                    </h2>
                    
                    {/* Th·∫ª ƒêi·ªÉm Xanh */}
                    <div className="mb-4 p-4 rounded-lg flex items-center justify-between" style={{ backgroundColor: TONE.ACCENT_GREEN, color: 'white' }}>
                        <div>
                            <p className="text-sm font-medium" style={{ fontFamily: 'Inter, sans-serif' }}>T·ªïng ƒêi·ªÉm Xanh (GreenPoints)</p>
                            <p className="text-4xl font-black mt-1" style={{ fontFamily: 'Quicksand, sans-serif' }}>{greenPoints}</p>
                        </div>
                        <button className="py-1 px-3 rounded-full text-xs font-semibold"
                            style={{ backgroundColor: TONE.ACCENT_DARK_GREEN }}
                            onClick={() => alert("Ch·ª©c nƒÉng ƒë·ªïi ∆∞u ƒë√£i s·∫Ω s·ªõm ra m·∫Øt!")}>
                            ƒê·ªïi Qu√†
                        </button>
                    </div>

                    {/* Th·ªëng k√™ ho·∫°t ƒë·ªông */}
                    <div className="grid grid-cols-2 gap-4 text-center">
                        <div className="p-3 rounded-lg border" style={{ borderColor: TONE.ACCENT_YELLOW }}>
                            <p className="text-2xl font-bold" style={{ color: TONE.ACCENT_DARK_GREEN }}>{itemsSwapped}</p>
                            <p className="text-xs" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>ƒê·ªì ƒë√£ Trao ƒë·ªïi/T·∫∑ng</p>
                        </div>
                        <div className="p-3 rounded-lg border" style={{ borderColor: TONE.ACCENT_YELLOW }}>
                            <p className="text-2xl font-bold" style={{ color: TONE.ACCENT_DARK_GREEN }}>{postsShared}</p>
                            <p className="text-xs" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>B√†i vi·∫øt ƒë√£ Chia s·∫ª</p>
                        </div>
                    </div>
                </div>
                
                <div className="bg-white rounded-xl p-6 mb-6 shadow-md" style={{ border: `1px solid ${TONE.ACCENT_GREEN}` }}>
                    <h2 className="text-xl font-bold mb-4" style={{ fontFamily: 'Playfair Display, serif', color: TONE.ACCENT_DARK_GREEN }}>Th√¥ng Tin T√†i Kho·∫£n</h2>
                    <div className="space-y-4">
                        <div className="flex items-center space-x-4">
                            <User size={32} style={{ color: TONE.ACCENT_DARK_GREEN }} />
                            <div>
                                {/* T√äN ƒê√É ƒê∆Ø·ª¢C C·∫¨P NH·∫¨T */}
                                <p className="font-semibold" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>Cao Ho√†ng Vinh</p> 
                                <p className="text-sm" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>vinh.cao@example.com</p>
                            </div>
                        </div>
                        <button className="w-full py-2 rounded-lg text-sm font-semibold border" style={{ borderColor: TONE.ACCENT_DARK_GREEN, color: TONE.ACCENT_DARK_GREEN, backgroundColor: TONE.BG_PRIMARY, fontFamily: 'Inter, sans-serif' }}>
                            Ch·ªânh s·ª≠a h·ªì s∆°
                        </button>
                        <button className="w-full py-2 rounded-lg text-sm font-semibold border" style={{ borderColor: TONE.ACCENT_DARK_GREEN, color: TONE.ACCENT_DARK_GREEN, backgroundColor: TONE.BG_PRIMARY, fontFamily: 'Inter, sans-serif' }}>
                            L·ªãch s·ª≠ ƒë∆°n h√†ng
                        </button>
                    </div>
                </div>

                <div className="bg-white rounded-xl p-6 shadow-md" style={{ border: `1px solid ${TONE.ACCENT_GREEN}` }}>
                    {/* ƒê√É C·∫¨P NH·∫¨T: Thay th·∫ø Grift b·∫±ng D·ªát M·ªôc */}
                    <h3 className="text-lg font-bold mb-3" style={{ fontFamily: 'Playfair Display, serif', color: TONE.ACCENT_DARK_GREEN }}>V·ªÅ D·ªát M·ªôc</h3>
                    {/* ƒê√É C·∫¨P NH·∫¨T: Thay th·∫ø Grift b·∫±ng D·ªát M·ªôc */}
                    <p className="text-sm leading-relaxed" style={{ fontFamily: 'Inter, sans-serif', color: TONE.TEXT_DARK }}>
                        D·ªát M·ªôc mang ƒë·∫øn nh·ªØng m√≥n qu√† th√¢n thi·ªán m√¥i tr∆∞·ªùng, tinh t·∫ø v√† ƒë·ªôc ƒë√°o. Ch√∫ng t√¥i tin v√†o v·∫ª ƒë·∫πp c·ªßa s·ª± t√°i sinh v√† gi√° tr·ªã th·ªß c√¥ng.
                    </p>
                    <button className="mt-4 w-full py-2 rounded-lg text-white font-semibold text-sm hover:opacity-90 transition-opacity"
                        style={{ backgroundColor: TONE.ACCENT_DARK_GREEN, fontFamily: 'Inter, sans-serif' }}>
                        T√¨m hi·ªÉu th√™m
                    </button>
                </div>
            </div>
        </div>
    );
};


/**
 * Component App Ch√≠nh (Qu·∫£n l√Ω tr·∫°ng th√°i)
 */
const App = () => {
  const [activeView, setActiveView] = useState('home');

  const renderView = () => {
    switch (activeView) {
      case 'home':
        return <HomeView />;
      case 'cart':
        return <CartView />;
      case 'profile':
        return <ProfileView />;
      case 'greenfit': // Green Inspire Zone
        return <GreenFitHub />;
      case 'shop': 
        return (
          // ƒê√É C·∫¨P NH·∫¨T: Th√™m padding bottom (pb-24)
          <div className="pt-8 pb-24 min-h-screen flex items-center justify-center text-center" style={{ background: TONE.GRADIENT_BG }}>
            {/* ∆Øu ƒê√£i d√πng TEXT_DARK */}
            <h2 className="text-2xl font-bold" style={{ fontFamily: 'Playfair Display, serif', color: TONE.TEXT_DARK }}>∆Øu ƒê√£i C·ªßa B·∫°n</h2> 
          </div>
        );
      default:
        return <HomeView />;
    }
  };

  return (
    // ƒê√£ lo·∫°i b·ªè max-w-sm v√† h-screen ƒë·ªÉ m·ªü r·ªông cho desktop
    <div className="min-h-screen antialiased" style={{ backgroundColor: TONE.BG_PRIMARY }}> 
      <div className="relative w-full flex flex-col min-h-screen">
        {/* Header tr√™n c√πng (Ch·ªâ c√≤n Logo v√† Gi·ªè h√†ng) */}
        <MobileHeader setActiveView={setActiveView} />
        <div className="flex-grow overflow-y-auto">
          {renderView()}
        </div>
        
        {/* THANH TAB BAR C·ªê ƒê·ªäNH ·ªû D∆Ø·ªöI */}
        <MobileBottomBar activeView={activeView} setActiveView={setActiveView} />
      </div>
    </div>
  );
};

// Thi·∫øt l·∫≠p font ch·ªØ cho to√†n b·ªô ·ª©ng d·ª•ng
const rootStyle = document.documentElement.style;
rootStyle.setProperty('font-family', 'Inter, sans-serif');
const link = document.createElement('link');
// ƒê√£ th√™m Quicksand v√†o link import font
link.href = 'https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700;900&family=Lora:wght@400;700&family=Quicksand:wght@500;700&display=swap';
link.rel = 'stylesheet';
document.head.appendChild(link);


export default App;
