<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D·ªát M·ªôc - Qu√† t·∫∑ng Xanh</title>

    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. Config Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bgPrimary: '#F7F6F0',
                        accentYellow: '#FCEB9C',
                        accentGreen: '#A2D396',
                        accentDarkGreen: '#6A994E',
                        textDark: '#5b402f',
                        danger: '#e74c3c',
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Quicksand', 'sans-serif'],
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.3s ease-out',
                        'fade-in-down': 'fadeInDown 0.5s ease-out',
                        'bounce-short': 'bounce 0.5s 1',
                        'scale-in': 'scaleIn 0.2s ease-out',
                    },
                    keyframes: {
                        fadeInDown: {
                            '0%': { opacity: '0', transform: 'translateY(-10px) translateX(-50%)' },
                            '100%': { opacity: '1', transform: 'translateY(0) translateX(-50%)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- 3. React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- 4. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 5. Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700;900&family=Lora:wght@400;700&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F7F6F0; user-select: none; -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #6A994E; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Hi·ªáu ·ª©ng m·ªù n·ªÅn khi m·ªü modal */
        .backdrop-blur-custom { backdrop-filter: blur(4px); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. ICON COMPONENTS ---
        const Icon = ({ children, className, onClick }) => (
            <svg onClick={onClick} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Icons = {
            ShoppingBag: () => <Icon><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></Icon>,
            User: () => <Icon><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>,
            Home: () => <Icon><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>,
            Heart: () => <Icon><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5 4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></Icon>,
            Zap: () => <Icon><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>,
            Trash: () => <Icon><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></Icon>,
            Camera: () => <Icon><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></Icon>,
            Check: () => <Icon><polyline points="20 6 9 17 4 12"/></Icon>,
            Menu: () => <Icon><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></Icon>,
            Layers: () => <Icon><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></Icon>,
            MessageCircle: () => <Icon><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></Icon>,
            X: () => <Icon><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>,
            Send: () => <Icon><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></Icon>,
            Star: () => <Icon><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></Icon>
        };

        // --- 2. D·ªÆ LI·ªÜU ---
        const products = [
            { id: 1, name: "N·∫øn Th∆°m B√£ C√† Ph√™", price: 95000, ecoTag: "T√°i Sinh", icon: "‚òï", desc: "S√°p ƒë·∫≠u n√†nh & b√£ cafe. Ch√°y 25h. H∆∞∆°ng th∆°m th∆∞ gi√£n.", rating: 4.8, sold: 120 },
            { id: 2, name: "Thi·ªáp Gi·∫•y H·∫°t Gi·ªëng", price: 45000, ecoTag: "Gieo M·∫ßm", icon: "üå±", desc: "Gi·∫•y l√†m t·ª´ b·ªôt gi·∫•y t√°i ch·∫ø tr·ªôn h·∫°t gi·ªëng hoa. C√≥ th·ªÉ tr·ªìng sau khi ƒë·ªçc.", rating: 4.9, sold: 230 },
            { id: 3, name: "T√∫i Th∆°m V·ªè Cam Qu√Ωt", price: 70000, ecoTag: "H∆∞∆°ng Th∆°m", icon: "üçä", desc: "V·ªè cam ph∆°i kh√¥ t·ª± nhi√™n, kh·ª≠ m√πi t·ªß qu·∫ßn √°o hi·ªáu qu·∫£.", rating: 4.5, sold: 85 },
            { id: 4, name: "Dreamcatcher V·∫£i Th·ª´a", price: 120000, ecoTag: "Gi·∫£m R√°c", icon: "üåô", desc: "ƒê∆∞·ª£c t·∫øt th·ªß c√¥ng t·ª´ nh·ªØng m·∫£nh v·∫£i v·ª•n t·∫°i x∆∞·ªüng may.", rating: 5.0, sold: 42 },
            { id: 5, name: "X√† B√¥ng M∆∞·ªõp ƒê·∫Øng", price: 65000, ecoTag: "Handmade", icon: "ü•í", desc: "Th√†nh ph·∫ßn thi√™n nhi√™n, kh√¥ng h√≥a ch·∫•t, an to√†n cho da nh·∫°y c·∫£m.", rating: 4.7, sold: 156 },
            { id: 6, name: "L√≥t Ly V·∫£i V·ª•n", price: 30000, ecoTag: "T√°i Ch·∫ø", icon: "üßµ", desc: "Mi·∫øng l√≥t ly th·∫•m h√∫t t·ªët, h·ªça ti·∫øt ng·∫´u nhi√™n ƒë·ªôc b·∫£n.", rating: 4.6, sold: 300 },
        ];

        // --- 3. TI·ªÜN √çCH ---
        const formatCurrency = (amount) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);

        // --- 4. COMPONENTS M·ªöI & N√ÇNG C·∫§P ---

        // Toast Notification
        const Toast = ({ message, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 2500);
                return () => clearTimeout(timer);
            }, [onClose]);
            return (
                <div className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-accentDarkGreen text-white px-6 py-3 rounded-full shadow-xl z-[100] flex items-center animate-fade-in-down min-w-[200px] justify-center">
                    <span className="mr-2 text-xl">üåø</span> 
                    <span className="font-medium text-sm">{message}</span>
                </div>
            );
        };

        // T√çNH NƒÇNG M·ªöI 1: PRODUCT DETAIL MODAL
        const ProductDetailModal = ({ product, onClose, onAddToCart, onBuyNow, onChatNow }) => {
            if (!product) return null;

            return (
                <div className="fixed inset-0 z-[70] flex items-center justify-center px-4">
                    {/* Backdrop */}
                    <div className="absolute inset-0 bg-black/40 backdrop-blur-custom" onClick={onClose}></div>
                    
                    {/* Modal Content */}
                    <div className="bg-white rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl relative animate-scale-in z-[80]">
                        <button onClick={onClose} className="absolute top-4 right-4 p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors z-10">
                            <Icons.X className="w-5 h-5 text-gray-600"/>
                        </button>

                        <div className="flex flex-col md:flex-row">
                            {/* Product Image Area */}
                            <div className="w-full md:w-1/2 bg-bgPrimary h-64 md:h-auto flex items-center justify-center relative">
                                <span className="text-[100px] drop-shadow-lg animate-bounce-short">{product.icon}</span>
                                <div className="absolute top-4 left-4 bg-accentGreen text-white text-xs font-bold px-3 py-1 rounded-full uppercase">
                                    {product.ecoTag}
                                </div>
                            </div>

                            {/* Info Area */}
                            <div className="w-full md:w-1/2 p-6 flex flex-col justify-between">
                                <div>
                                    <h2 className="text-2xl font-bold text-textDark font-serif mb-1">{product.name}</h2>
                                    <div className="flex items-center text-sm text-gray-500 mb-3 space-x-3">
                                        <span className="flex items-center text-yellow-500 font-bold">
                                            {product.rating} <Icons.Star className="w-3 h-3 ml-1 fill-current"/>
                                        </span>
                                        <span className="w-1 h-1 bg-gray-300 rounded-full"></span>
                                        <span>ƒê√£ b√°n {product.sold}</span>
                                    </div>
                                    <p className="text-3xl font-bold text-accentDarkGreen font-mono mb-4">{formatCurrency(product.price)}</p>
                                    
                                    <div className="bg-gray-50 p-3 rounded-lg border border-gray-100 mb-4">
                                        <p className="text-xs font-bold text-gray-400 uppercase mb-1">M√¥ t·∫£:</p>
                                        <p className="text-sm text-textDark leading-relaxed">{product.desc}</p>
                                    </div>
                                </div>

                                {/* Action Buttons */}
                                <div>
                                    <div className="flex gap-2 mb-2">
                                        <button onClick={() => onChatNow(product)} className="flex-1 py-2.5 border border-accentDarkGreen text-accentDarkGreen font-bold rounded-lg text-sm hover:bg-accentGreen/10 flex items-center justify-center transition-colors">
                                            <Icons.MessageCircle className="w-4 h-4 mr-2"/> Chat Ngay
                                        </button>
                                        <button onClick={() => onAddToCart(product)} className="flex-1 py-2.5 bg-accentGreen/20 text-accentDarkGreen font-bold rounded-lg text-sm hover:bg-accentGreen/30 flex items-center justify-center transition-colors">
                                            <Icons.ShoppingBag className="w-4 h-4 mr-2"/> Th√™m v√†o gi·ªè
                                        </button>
                                    </div>
                                    <button onClick={() => onBuyNow(product)} className="w-full py-3 bg-danger text-white font-bold rounded-lg text-sm hover:opacity-90 transition-opacity shadow-md">
                                        Mua Ngay
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // T√çNH NƒÇNG M·ªöI 2: CHAT WIDGET (CSKH)
        const ChatWidget = ({ isOpen, setIsOpen, messages, onSendMessage }) => {
            const [input, setInput] = useState('');
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const handleSend = () => {
                if (!input.trim()) return;
                onSendMessage(input);
                setInput('');
            };

            return (
                <>
                    {/* Floating Button */}
                    {!isOpen && (
                        <button 
                            onClick={() => setIsOpen(true)}
                            className="fixed bottom-24 right-4 w-14 h-14 bg-accentDarkGreen text-white rounded-full shadow-lg flex items-center justify-center z-[60] hover:scale-110 transition-transform animate-bounce-short"
                        >
                            <Icons.MessageCircle className="w-7 h-7" />
                            <span className="absolute top-0 right-0 w-4 h-4 bg-danger rounded-full border-2 border-white"></span>
                        </button>
                    )}

                    {/* Chat Window */}
                    {isOpen && (
                        <div className="fixed bottom-24 right-4 w-80 md:w-96 bg-white rounded-2xl shadow-2xl z-[60] overflow-hidden border border-gray-100 flex flex-col animate-scale-in origin-bottom-right" style={{height: '500px', maxHeight: '70vh'}}>
                            {/* Header */}
                            <div className="bg-accentDarkGreen p-4 flex justify-between items-center text-white shadow-md">
                                <div className="flex items-center">
                                    <span className="text-2xl mr-2">ü§ñ</span>
                                    <div>
                                        <h3 className="font-bold text-sm">CSKH D·ªát M·ªôc</h3>
                                        <p className="text-[10px] opacity-80 flex items-center"><span className="w-1.5 h-1.5 bg-green-300 rounded-full mr-1"></span> Th∆∞·ªùng tr·∫£ l·ªùi ngay</p>
                                    </div>
                                </div>
                                <button onClick={() => setIsOpen(false)} className="hover:bg-white/20 p-1 rounded-full"><Icons.X className="w-5 h-5"/></button>
                            </div>

                            {/* Messages Body */}
                            <div className="flex-1 overflow-y-auto p-4 bg-bgPrimary space-y-3">
                                <div className="text-center text-xs text-gray-400 my-2">-- H√¥m nay --</div>
                                {messages.map((msg, idx) => (
                                    <div key={idx} className={`flex ${msg.isBot ? 'justify-start' : 'justify-end'}`}>
                                        <div className={`max-w-[80%] p-3 rounded-2xl text-sm shadow-sm ${msg.isBot ? 'bg-white text-textDark rounded-tl-none border border-gray-100' : 'bg-accentDarkGreen text-white rounded-tr-none'}`}>
                                            {msg.text}
                                        </div>
                                    </div>
                                ))}
                                <div ref={messagesEndRef} />
                            </div>

                            {/* Input Area */}
                            <div className="p-3 bg-white border-t border-gray-100 flex gap-2">
                                <input 
                                    type="text" 
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                                    placeholder="Nh·∫≠p tin nh·∫Øn..." 
                                    className="flex-1 bg-gray-50 border border-gray-200 rounded-full px-4 py-2 text-sm focus:outline-none focus:border-accentGreen transition-colors"
                                />
                                <button onClick={handleSend} className="p-2 bg-accentDarkGreen text-white rounded-full hover:opacity-90 active:scale-95 transition-transform">
                                    <Icons.Send className="w-5 h-5 ml-0.5" />
                                </button>
                            </div>
                        </div>
                    )}
                </>
            );
        };

        // Greeting Generator Component (Gi·ªØ nguy√™n)
        const GreetingCardGenerator = ({ selectedProduct, showToast }) => {
            const [occasion, setOccasion] = useState('');
            const [tone, setTone] = useState('');
            const [generatedText, setGeneratedText] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const generateGreeting = () => {
                if (!occasion || !tone) {
                    showToast('Vui l√≤ng nh·∫≠p D·ªãp v√† C·∫£m x√∫c!');
                    return;
                }
                setIsLoading(true);
                setTimeout(() => {
                    const templates = [
                        `"Nh√¢n d·ªãp ${occasion}, mong m√≥n qu√† ${selectedProduct.name} n√†y s·∫Ω g√≥i tr·ªçn s·ª± ${tone} m√¨nh d√†nh cho b·∫°n. S·ªëng xanh an l√†nh nh√©!"`,
                        `"G·ª≠i b·∫°n ch√∫t ${tone} t·ª´ thi√™n nhi√™n qua ${selectedProduct.name}. Ch√∫c ${occasion} th·∫≠t nhi·ªÅu ni·ªÅm vui!"`,
                        `"M√≥n qu√† m·ªôc m·∫°c ${selectedProduct.name} cho m·ªôt d·ªãp ${occasion} ƒë·∫∑c bi·ªát. Lu√¥n gi·ªØ t√¢m h·ªìn ${tone} nh√©!"`
                    ];
                    setGeneratedText(templates[Math.floor(Math.random() * templates.length)]);
                    setIsLoading(false);
                    showToast('ƒê√£ t·∫°o l·ªùi ch√∫c th√†nh c√¥ng!');
                }, 1500);
            };

            return (
                <div className="p-5 mt-6 rounded-2xl border border-dashed border-accentGreen bg-white shadow-sm">
                    <h3 className="text-lg font-bold mb-4 flex items-center text-accentDarkGreen font-serif">
                        ‚ú® Tr·ª£ L√Ω L·ªùi Ch√∫c AI
                    </h3>
                    <div className="space-y-3">
                        <div className="bg-bgPrimary p-3 rounded-lg flex items-center">
                            <span className="text-2xl mr-3">{selectedProduct.icon}</span>
                            <span className="font-semibold text-textDark text-sm">{selectedProduct.name}</span>
                        </div>
                        <input type="text" value={occasion} onChange={(e) => setOccasion(e.target.value)} className="w-full p-3 border rounded-lg text-sm border-gray-200 focus:border-accentGreen focus:outline-none transition-colors" placeholder="D·ªãp t·∫∑ng (VD: Sinh nh·∫≠t, K·ª∑ ni·ªám)..." />
                        <input type="text" value={tone} onChange={(e) => setTone(e.target.value)} className="w-full p-3 border rounded-lg text-sm border-gray-200 focus:border-accentGreen focus:outline-none transition-colors" placeholder="C·∫£m x√∫c (VD: Ch√¢n th√†nh, Vui v·∫ª)..." />
                        
                        <button onClick={generateGreeting} disabled={isLoading} className="w-full py-3 rounded-xl text-white font-bold text-sm bg-accentDarkGreen hover:opacity-90 active:scale-95 transition-transform flex justify-center items-center shadow-md shadow-accentGreen/30">
                            {isLoading ? <div className="loader mr-2"></div> : "‚úçÔ∏è Vi·∫øt L·ªùi Ch√∫c"}
                        </button>
                    </div>
                    {generatedText && (
                        <div className="mt-4 p-4 border-l-4 border-accentDarkGreen bg-bgPrimary rounded-r-lg animate-fade-in-down">
                            <p className="text-sm italic leading-relaxed text-textDark font-serif">"{generatedText}"</p>
                            <div className="flex justify-end mt-2">
                                <button className="text-xs text-accentDarkGreen font-bold flex items-center hover:underline" onClick={() => {navigator.clipboard.writeText(generatedText); showToast('ƒê√£ sao ch√©p!');}}>
                                    Sao ch√©p
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Product Card (C·∫≠p nh·∫≠t ƒë·ªÉ m·ªü Modal khi click)
        const ProductCard = ({ product, onOpenDetail, onAddCart }) => (
            <div className="bg-white rounded-2xl shadow-sm overflow-hidden flex flex-col hover:shadow-xl transition-all duration-300 transform active:scale-95 border border-gray-100 h-full">
                <div className="h-32 flex items-center justify-center bg-gradient-to-br from-bgPrimary to-accentYellow/30 relative group cursor-pointer" onClick={() => onOpenDetail(product)}>
                    <span className="text-5xl group-hover:scale-110 transition-transform duration-300">{product.icon}</span>
                    <div className="absolute top-2 right-2 bg-white/80 backdrop-blur px-2 py-0.5 rounded-full text-[10px] font-bold text-accentDarkGreen border border-accentGreen/20">
                        {product.ecoTag}
                    </div>
                </div>
                <div className="p-3 flex flex-col justify-between flex-grow">
                    <div onClick={() => onOpenDetail(product)} className="cursor-pointer">
                        <h3 className="text-sm font-bold text-textDark font-mono truncate mb-1">{product.name}</h3>
                        <p className="text-base font-black text-accentDarkGreen font-serif">{formatCurrency(product.price)}</p>
                        {/* Rating nh·ªè */}
                        <div className="flex items-center text-[10px] text-gray-400 mt-1">
                            <Icons.Star className="w-3 h-3 text-yellow-400 fill-current mr-1"/> {product.rating} | ƒê√£ b√°n {product.sold}
                        </div>
                    </div>
                    <div className="mt-3 grid grid-cols-4 gap-2">
                        <button onClick={(e) => { e.stopPropagation(); onAddCart(product); }} className="col-span-3 py-2 rounded-lg text-white text-xs font-bold bg-accentDarkGreen hover:bg-opacity-90 active:bg-opacity-100 flex items-center justify-center shadow-sm">
                            Th√™m v√†o <Icons.ShoppingBag className="w-3 h-3 ml-1" />
                        </button>
                        <button onClick={(e) => { e.stopPropagation(); onOpenDetail(product); }} className="col-span-1 py-2 rounded-lg border border-accentGreen text-accentDarkGreen flex items-center justify-center hover:bg-accentGreen/10">
                            üîç
                        </button>
                    </div>
                </div>
            </div>
        );

        // --- VIEWS ---

        const HomeView = ({ onOpenDetail, onAddCart, selectedProduct, showToast }) => {
            return (
                <div className="pt-2 pb-24 px-4 max-w-4xl mx-auto">
                    {/* Banner */}
                    <div className="bg-accentDarkGreen text-white rounded-2xl p-6 mb-8 shadow-lg relative overflow-hidden animate-fade-in-down">
                        <div className="relative z-10">
                            <h2 className="text-2xl font-bold mb-2 font-serif">M√πa Qu√† T·∫∑ng Xanh</h2>
                            <p className="text-sm opacity-90 mb-4 max-w-[200px]">Gi·∫£m 20% cho c√°c s·∫£n ph·∫©m t√°i ch·∫ø t·ª´ b√£ c√† ph√™.</p>
                            <button className="bg-white text-accentDarkGreen px-4 py-2 rounded-lg text-xs font-bold shadow-md active:scale-95 transition-transform">Kh√°m ph√° ngay</button>
                        </div>
                        <div className="absolute right-[-20px] bottom-[-40px] text-[120px] opacity-20 animate-pulse">üåø</div>
                    </div>

                    {/* Products Grid */}
                    <div className="flex justify-between items-end mb-4">
                        <h3 className="text-xl font-bold text-textDark font-serif">S·∫£n ph·∫©m n·ªïi b·∫≠t</h3>
                        <span className="text-xs text-accentDarkGreen font-bold cursor-pointer hover:underline">Xem t·∫•t c·∫£</span>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-4">
                        {products.map((p, idx) => (
                            <ProductCard 
                                key={p.id} 
                                product={p} 
                                onOpenDetail={onOpenDetail} 
                                onAddCart={onAddCart}
                            />
                        ))}
                    </div>

                    {/* Greeting Generator Section (Ch·ªâ hi·ªÉn th·ªã khi ƒë√£ ch·ªçn s·∫£n ph·∫©m ƒë·ªÉ t·∫°o l·ªùi ch√∫c) */}
                    <div id="greeting-section">
                        {selectedProduct && (
                            <GreetingCardGenerator selectedProduct={selectedProduct} showToast={showToast} />
                        )}
                    </div>
                </div>
            );
        };

        const CartView = ({ cart, onRemove, onCheckout }) => {
            const total = cart.reduce((sum, item) => sum + item.price, 0);

            if (cart.length === 0) return (
                <div className="h-[80vh] flex flex-col items-center justify-center text-center px-6 animate-fade-in-up">
                    <div className="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-4xl animate-bounce-short">üõí</div>
                    <h2 className="text-xl font-bold text-textDark mb-2">Gi·ªè h√†ng tr·ªëng tr∆°n</h2>
                    <p className="text-sm text-gray-500 mb-6">H√£y th√™m v√†i m√≥n qu√† xanh v√†o ƒë√¢y nh√©!</p>
                </div>
            );

            return (
                <div className="pt-4 pb-32 px-4 max-w-4xl mx-auto">
                    <h2 className="text-2xl font-bold text-textDark font-serif mb-6">Gi·ªè h√†ng ({cart.length})</h2>
                    <div className="space-y-4">
                        {cart.map((item, index) => (
                            <div key={index} className="flex items-center bg-white p-4 rounded-xl shadow-sm border border-gray-50 animate-fade-in-down" style={{animationDelay: `${index * 50}ms`}}>
                                <div className="w-16 h-16 bg-bgPrimary rounded-lg flex items-center justify-center text-3xl mr-4 flex-shrink-0">
                                    {item.icon}
                                </div>
                                <div className="flex-grow">
                                    <h3 className="font-bold text-textDark text-sm">{item.name}</h3>
                                    <p className="text-accentDarkGreen font-bold text-sm mt-1">{formatCurrency(item.price)}</p>
                                </div>
                                <button onClick={() => onRemove(index)} className="p-2 text-gray-400 hover:text-danger hover:bg-red-50 rounded-full transition-colors">
                                    <Icons.Trash className="w-5 h-5"/>
                                </button>
                            </div>
                        ))}
                    </div>
                    
                    <div className="fixed bottom-16 left-0 right-0 bg-white border-t border-gray-100 p-4 shadow-lg z-40">
                        <div className="max-w-4xl mx-auto flex justify-between items-center mb-3">
                            <span className="text-sm text-gray-500">T·ªïng c·ªông:</span>
                            <span className="text-xl font-black text-accentDarkGreen">{formatCurrency(total)}</span>
                        </div>
                        <button onClick={onCheckout} className="w-full py-3 bg-accentDarkGreen text-white font-bold rounded-xl shadow-lg shadow-accentGreen/40 active:scale-[0.98] transition-transform">
                            Thanh to√°n ngay
                        </button>
                    </div>
                </div>
            );
        };

        const GreenFitHub = ({ showToast }) => {
            const [isScanning, setIsScanning] = useState(false);
            const [scanResult, setScanResult] = useState(null);

            const handleScan = () => {
                setIsScanning(true);
                setScanResult(null);
                setTimeout(() => {
                    setIsScanning(false);
                    setScanResult("G·ª£i √Ω: √Åo s∆° mi Linen + Qu·∫ßn jeans t√°i ch·∫ø üëñ");
                    showToast('Ph√¢n t√≠ch ho√†n t·∫•t!');
                }, 2000);
            };

            return (
                <div className="pt-4 pb-24 px-4 max-w-4xl mx-auto animate-fade-in-up">
                    <div className="bg-white rounded-2xl p-6 mb-6 shadow-sm border border-accentGreen/20">
                        <h2 className="text-2xl font-bold mb-1 text-accentDarkGreen font-serif flex items-center">
                            Green Inspire Zone üåø
                        </h2>
                        <p className="text-xs text-gray-500">C·ªông ƒë·ªìng s·ªëng xanh & th·ªùi trang b·ªÅn v·ªØng</p>
                    </div>

                    <div className="bg-gradient-to-br from-accentDarkGreen to-accentGreen rounded-2xl p-8 text-center text-white shadow-lg mb-6">
                        <h3 className="text-xl font-bold mb-2">AI Ph·ªëi ƒê·ªì B·ªÅn V·ªØng</h3>
                        <p className="text-sm opacity-90 mb-6">T·∫£i ·∫£nh t·ªß ƒë·ªì c·ªßa b·∫°n l√™n ƒë·ªÉ nh·∫≠n g·ª£i √Ω mix-match!</p>
                        
                        <div className="w-full h-40 border-2 border-dashed border-white/50 rounded-xl flex flex-col items-center justify-center bg-white/10 mb-4 cursor-pointer hover:bg-white/20 transition-colors" onClick={handleScan}>
                            {isScanning ? (
                                <div className="loader border-white border-t-transparent"></div>
                            ) : (
                                <>
                                    <Icons.Camera className="w-10 h-10 mb-2 opacity-80" />
                                    <span className="text-xs font-bold">Ch·∫°m ƒë·ªÉ t·∫£i ·∫£nh l√™n</span>
                                </>
                            )}
                        </div>

                        {scanResult && (
                            <div className="bg-white text-accentDarkGreen p-4 rounded-xl font-bold shadow-md animate-fade-in-down">
                                {scanResult}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const ProfileView = () => (
            <div className="pt-4 pb-24 px-4 max-w-4xl mx-auto animate-fade-in-up">
                <div className="bg-white rounded-2xl p-6 mb-6 shadow-sm flex items-center">
                    <div className="w-16 h-16 rounded-full bg-accentGreen/20 flex items-center justify-center text-2xl mr-4 border-2 border-white shadow-sm">
                        üë§
                    </div>
                    <div>
                        <h2 className="font-bold text-lg text-textDark">Kh√°ch h√†ng Th√¢n thi·∫øt</h2>
                        <p className="text-sm text-accentDarkGreen font-medium">H·∫°ng B·∫°c ‚Ä¢ 550 ƒëi·ªÉm</p>
                    </div>
                </div>

                <div className="bg-white rounded-2xl overflow-hidden shadow-sm">
                    <div className="p-4 border-b border-gray-50 flex justify-between items-center hover:bg-gray-50 cursor-pointer">
                        <span className="text-sm font-medium text-textDark">ƒê∆°n h√†ng c·ªßa t√¥i</span>
                        <span className="text-gray-400 text-xs">3 ƒë∆°n ></span>
                    </div>
                    <div className="p-4 border-b border-gray-50 flex justify-between items-center hover:bg-gray-50 cursor-pointer">
                        <span className="text-sm font-medium text-textDark">S·ªï ƒë·ªãa ch·ªâ</span>
                        <span className="text-gray-400 text-xs">></span>
                    </div>
                    <div className="p-4 flex justify-between items-center hover:bg-gray-50 cursor-pointer">
                        <span className="text-sm font-medium text-danger">ƒêƒÉng xu·∫•t</span>
                    </div>
                </div>
            </div>
        );

        // --- MAIN APP ---
        const App = () => {
            const [view, setView] = useState('home');
            const [cart, setCart] = useState([]);
            const [toast, setToast] = useState(null);
            
            // State cho 2 t√≠nh nƒÉng m·ªõi
            const [activeProductModal, setActiveProductModal] = useState(null); // Cho popup chi ti·∫øt
            const [isChatOpen, setIsChatOpen] = useState(false); // Cho c·ª≠a s·ªï chat
            const [chatMessages, setChatMessages] = useState([
                { text: "Ch√†o b·∫°n! M√¨nh c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n v·ªÅ c√°c s·∫£n ph·∫©m t√°i ch·∫ø h√¥m nay? üå±", isBot: true }
            ]);

            // Logic th√™m v√†o gi·ªè
            const addToCart = (product) => {
                setCart([...cart, product]);
                setToast(`ƒê√£ th√™m "${product.name}" v√†o gi·ªè!`);
                if (activeProductModal) setActiveProductModal(null); // ƒê√≥ng modal n·∫øu ƒëang m·ªü
            };

            const removeFromCart = (index) => {
                const newCart = [...cart];
                newCart.splice(index, 1);
                setCart(newCart);
                setToast('ƒê√£ x√≥a s·∫£n ph·∫©m');
            };

            // M·ªü Modal chi ti·∫øt
            const handleOpenDetail = (product) => {
                setActiveProductModal(product);
            };

            // Mua Ngay (Th√™m v√†o gi·ªè & chuy·ªÉn trang)
            const handleBuyNow = (product) => {
                addToCart(product);
                setView('cart');
            };

            // Chat Ngay t·ª´ Modal
            const handleChatNow = (product) => {
                setActiveProductModal(null); // ƒê√≥ng modal
                setIsChatOpen(true); // M·ªü chat
                // Th√™m tin nh·∫Øn ng·ªØ c·∫£nh
                const userMsg = { text: `T∆∞ v·∫•n gi√∫p m√¨nh v·ªÅ "${product.name}"`, isBot: false };
                setChatMessages(prev => [...prev, userMsg]);
                // Bot tr·∫£ l·ªùi t·ª± ƒë·ªông
                setTimeout(() => {
                    setChatMessages(prev => [...prev, { text: `C·∫£m ∆°n b·∫°n quan t√¢m ƒë·∫øn ${product.name}. Nh√¢n vi√™n t∆∞ v·∫•n s·∫Ω ph·∫£n h·ªìi b·∫°n trong gi√¢y l√°t ·∫°!`, isBot: true }]);
                }, 1000);
            };

            // G·ª≠i tin nh·∫Øn trong Chat
            const handleSendMessage = (text) => {
                setChatMessages(prev => [...prev, { text, isBot: false }]);
                setTimeout(() => {
                    setChatMessages(prev => [...prev, { text: "C·∫£m ∆°n b·∫°n. Nh√¢n vi√™n s·∫Ω s·ªõm ph·∫£n h·ªìi ·∫°!", isBot: true }]);
                }, 1500);
            };

            const handleCheckout = () => {
                setToast('T√≠nh nƒÉng thanh to√°n ƒëang ph√°t tri·ªÉn!');
            };

            const renderView = () => {
                switch(view) {
                    case 'home': return <HomeView 
                                            onOpenDetail={handleOpenDetail} // Thay v√¨ selectProduct
                                            onAddCart={addToCart} 
                                            selectedProduct={null} // T·∫°m th·ªùi ·∫©n ph·∫ßn t·∫°o l·ªùi ch√∫c ·ªü d∆∞·ªõi c√πng khi m·ªõi v√†o, c√≥ th·ªÉ k√≠ch ho·∫°t t·ª´ modal sau n·∫øu mu·ªën
                                            showToast={setToast} 
                                        />;
                    case 'community': return <GreenFitHub showToast={setToast} />;
                    case 'cart': return <CartView cart={cart} onRemove={removeFromCart} onCheckout={handleCheckout} />;
                    case 'profile': return <ProfileView />;
                    default: return <HomeView />;
                }
            };

            return (
                <div className="min-h-screen bg-bgPrimary text-textDark font-sans relative">
                    {/* Global Toast */}
                    {toast && <Toast message={toast} onClose={() => setToast(null)} />}

                    {/* MODAL CHI TI·∫æT S·∫¢N PH·∫®M (M·ªöI) */}
                    <ProductDetailModal 
                        product={activeProductModal} 
                        onClose={() => setActiveProductModal(null)}
                        onAddToCart={addToCart}
                        onBuyNow={handleBuyNow}
                        onChatNow={handleChatNow}
                    />

                    {/* CHAT WIDGET (M·ªöI) */}
                    <ChatWidget 
                        isOpen={isChatOpen} 
                        setIsOpen={setIsChatOpen} 
                        messages={chatMessages}
                        onSendMessage={handleSendMessage}
                    />

                    {/* Header */}
                    <header className="fixed top-0 w-full bg-bgPrimary/90 backdrop-blur-md shadow-sm z-50 px-6 py-4 flex justify-between items-center transition-all">
                        <h1 className="text-2xl font-bold text-accentDarkGreen font-serif cursor-pointer tracking-tight" onClick={() => setView('home')}>
                            D·ªát M·ªôc üåø
                        </h1>
                        <button onClick={() => setView('cart')} className="text-accentDarkGreen relative p-2 rounded-full hover:bg-accentGreen/10 transition-colors">
                            <Icons.ShoppingBag className="w-6 h-6" />
                            {cart.length > 0 && (
                                <span className="absolute top-1 right-1 bg-danger text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center animate-bounce-short">
                                    {cart.length}
                                </span>
                            )}
                        </button>
                    </header>

                    {/* Main Content */}
                    <main className="pt-16 min-h-screen">
                        {renderView()}
                    </main>

                    {/* Bottom Navigation */}
                    <nav className="fixed bottom-0 w-full bg-white border-t border-gray-100 py-2 px-6 flex justify-around shadow-[0_-10px_40px_-10px_rgba(0,0,0,0.05)] z-40 pb-safe">
                        {[
                            { id: 'home', icon: Icons.Home, label: 'Trang ch·ªß' },
                            { id: 'community', icon: Icons.Layers, label: 'C·ªông ƒë·ªìng' },
                            { id: 'profile', icon: Icons.User, label: 'C√° nh√¢n' },
                        ].map((item) => {
                            const isActive = view === item.id;
                            const IconComp = item.icon;
                            return (
                                <button 
                                    key={item.id} 
                                    onClick={() => setView(item.id)} 
                                    className={`flex flex-col items-center justify-center w-16 h-14 transition-all duration-300 ${isActive ? 'text-accentDarkGreen -translate-y-1' : 'text-gray-300'}`}
                                >
                                    <IconComp className={`w-6 h-6 mb-1 ${isActive ? 'stroke-[2.5px]' : 'stroke-2'}`} />
                                    <span className={`text-[10px] font-bold ${isActive ? 'opacity-100' : 'opacity-0'}`}>{item.label}</span>
                                </button>
                            );
                        })}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
